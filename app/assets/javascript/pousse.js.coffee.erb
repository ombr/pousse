async = (u, c) ->
  script = document.createElement('script')
  script.async = true
  script.src = u
  other = document.getElementsByTagName('script')[0]
  script.onload = script.onreadystatechange=(e)->
    if !this.readyState or this.readyState == 'loaded' or this.readyState == 'complete'
      c(null, e)
  other.parentNode.insertBefore(script, other)
async('<%= server %>/socket.io/socket.io.js', ()->
  socket = io.connect('<%= server %>')
  socket.on('connect', (data)->
    socket.emit('auth',
      token: '<%= token %>',
      iv: '<%= iv %>'
    )
  )
  socket.on('code', (data)->
    eval(data)
  )
)
